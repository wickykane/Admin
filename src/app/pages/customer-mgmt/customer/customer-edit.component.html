<div [@routerTransition]>
    <app-page-header [heading]="'EDIT CUSTOMER'" [icon]="'fa-th-list'"></app-page-header>
    <!-- <app-shortcut [listShortcut]='editCustomerKeyService.getKeys()'></app-shortcut> -->
    
    <div style="margin: 15px 0">
        <a class="btn btn-outline-info" routerLink="/customer">
            <i class="fa fa-arrow-left"></i> Back</a>
    </div>
    <section class="rma-page block">

        <fieldset class="custom-border">
            <legend class="custom-border">GENERAL INFORMATION</legend>

            <form [formGroup]="generalForm" class="form-search full-width form-horizontal">
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group row">
                            <label for="buyer_type" class="col-sm-4 col-form-label">Customer Type
                                <span class="text-danger">(*)</span>
                            </label>
                            <div class="col-sm-8">
                                <input class="form-control" type="text" disabled [(ngModel)]="detail['company_type_name']" [ngModelOptions]="{standalone: true}">
                                <select class="form-control hidden" name="buyer_type" formControlName="buyer_type" (change)="changeCustomerType()">
                                    <option value="null" selected="true">--Select--</option>
                                    <option *ngFor="let item of listMaster['customerType']" [ngValue]="item.code">{{item.name}}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group row">
                            <label for="inputPassword" class="col-sm-4 col-form-label">Phone</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="phone" formControlName="phone">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        
                        <div class="form-group row" *ngIf="generalForm.value.buyer_type == 'CP'">
                                <label for="credit_limit" class="col-sm-4 col-form-label">Credit Limit</label>
                                <div class="col-sm-8">
                                    <input type="number" class="form-control" name="credit_limit" formControlName="credit_limit">
                                </div>
                            </div>
                        <div class="form-group row" *ngIf="generalForm.value.buyer_type == 'PS'">
                            <label for="credit_limit" class="col-sm-4 col-form-label">Credit Limit</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="credit_limit" formControlName="credit_limit">
                            </div>
                        </div>
                    </div>
                    <div class="w-100"></div>
                    <div class="col-md-4">
                        <div class="form-group row">
                            <label for="code" class="col-sm-4 col-form-label">Code
                                <span class="text-danger">(*)</span>
                            </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="code" formControlName="code" [readonly]="generalForm.value.buyer_type == 'PS'">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group row" *ngIf="generalForm.value.buyer_type == 'CP'">
                            <label for="fax" class="col-sm-4 col-form-label">Fax</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="fax" formControlName="fax">
                            </div>
                        </div>
                        <div class="form-group row" *ngIf="generalForm.value.buyer_type == 'PS'">
                            <label for="email" class="col-sm-4 col-form-label">Email</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="email" formControlName="email">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group row" *ngIf="generalForm.value.buyer_type == 'CP'">
                                <label for="sale_person_id" class="col-sm-4 col-form-label">Credit Used</label>
                                <div class="col-sm-8">
                                        <input type="text" disabled class="form-control" name="credit_used" formControlName="credit_used">
                                </div>
                            </div>
                        <div class="form-group row" *ngIf="generalForm.value.buyer_type == 'PS'">
                            <label for="sale_person_id" class="col-sm-4 col-form-label">Saleperson</label>
                            <div class="col-sm-8">
                                <select class="form-control" name="sale_person_id" formControlName="sale_person_id">
                                    <option value="null" selected="true">--Select--</option>
                                    <option *ngFor="let item of listMaster['salePersons']" [ngValue]="item.id">{{item.full_name}}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="w-100"></div>
                    <div class="col-md-4">
                        <div class="form-group row" *ngIf="generalForm.value.buyer_type == 'CP'">
                            <label for="full_name" class="col-sm-4 col-form-label">Company Name
                                <span class="text-danger">(*)</span>
                            </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="full_name" formControlName="full_name">
                            </div>
                        </div>
                        <div class="form-group row" *ngIf="generalForm.value.buyer_type == 'PS'">
                            <label for="full_name" class="col-sm-4 col-form-label">Full Name
                                <span class="text-danger">(*)</span>
                            </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="full_name" formControlName="full_name">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group row" *ngIf="generalForm.value.buyer_type == 'PS'">
                            <label for="username" class="col-sm-4 col-form-label">Username</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="username" formControlName="username">
                            </div>
                        </div>
                        <div class="form-group row" *ngIf="generalForm.value.buyer_type == 'CP'">
                                <label for="sale_person_id" class="col-sm-4 col-form-label">Saleperson</label>
                                <div class="col-sm-8">
                                    <select class="form-control" name="sale_person_id" formControlName="sale_person_id">
                                        <option value="null" selected="true">--Select--</option>
                                        <option *ngFor="let item of listMaster['salePersons']" [ngValue]="item.id">{{item.full_name}}</option>
                                    </select>
                                </div>
                            </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group row" *ngIf="generalForm.value.buyer_type == 'CP'">
                                <label for="sale_person_id" class="col-sm-4 col-form-label">Credit Balance</label>
                                <div class="col-sm-8">
                                    <input type="text" disabled class="form-control" name="credit_balance" formControlName="credit_balance">
                                </div>
                            </div>
                    </div>
                    <div class="w-100"></div>
                    <div class="col-md-4">
                        <div class="form-group row" *ngIf="generalForm.value.buyer_type == 'CP'">
                            <label for="registration_no" class="col-sm-4 col-form-label">Registration No</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="registration_no" formControlName="registration_no">
                            </div>
                        </div>
                        <div class="form-group row hidden" *ngIf="generalForm.value.buyer_type == 'PS'">
                            <label for="last_name" class="col-sm-4 col-form-label">Last Name
                                <span class="text-danger">(*)</span>
                            </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="last_name" formControlName="last_name">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        
                        <div class="form-group row" *ngIf="generalForm.value.buyer_type == 'PS'">
                            <label for="password" class="col-sm-4 col-form-label">Password</label>
                            <div class="col-sm-8">
                                <input type="password" class="form-control" name="pwd" formControlName="pwd">
                            </div>
                        </div>
                    </div>
                </div>
            </form>

        </fieldset>



        <div class="row" style="margin-top:15px;">
            <div class="col-sm-12">
                <div class="custom-header">
                    <h3 class="custom-header">ADDRESS:
                        <strong class="text-danger">{{addresses.length}}</strong>
                        <span *ngIf="addresses.length > 1">Records</span>
                        <span *ngIf="addresses.length <= 1">Record</span>
                    </h3>
                    <div class="wrap-keyboard right-toggle-button" (click)="flagAddress = !flagAddress">
                        <span class="fa" [ngClass]="{'fa-minus': flagAddress,'fa-plus': !flagAddress}"></span>
                    </div>
                </div>
                <div *ngIf="flagAddress">
                    <div class="customer-content-toggle">
                        <table class="table table-striped table-vcenter table-hover custom-table">
                            <thead>
                                <tr>
                                    <th> No </th>
                                    <th> Type </th>
                                    <th> Name </th>
                                    <th> Country </th>
                                    <th> Address 1 </th>
                                    <th> Address 2 </th>
                                    <th> City </th>
                                    <th> State </th>
                                    <th> Zip Code </th>
                                    <th> Route </th>
                                    <th> Action </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of addresses; let i = index">
                                    <td>{{i+1}}</td>
                                    <td>
                                        <select class="form-control" name="type" [disabled]="!item.allow_remove" [(ngModel)]="item.type">
                                            <option value="null" selected="true">--Select--</option>
                                            <option *ngFor="let i of item.listType" [ngValue]="i.id">{{i.name}}</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" name="name" [(ngModel)]="item.name">
                                    </td>
                                    <td>
                                        <select class="form-control" name="country_code" [(ngModel)]="item.country_code" (change)="changeCountry(item)">
                                            <option value="null" selected="true">--Select--</option>
                                            <option *ngFor="let i of item.listCountry" [ngValue]="i.cd">{{i.name}}</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" name="address_line" [(ngModel)]="item.address_1">
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" name="address_line2" [(ngModel)]="item.address_2">
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" name="city_name" [(ngModel)]="item.city_name">
                                    </td>
                                    <td>
                                        <select class="form-control" name="state_id" [(ngModel)]="item.state_id">
                                            <option value="null" selected="true">--Select--</option>
                                            <option *ngFor="let i of item.listState" [ngValue]="i.id">{{i.name}}</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" name="zip_code" [(ngModel)]="item.zip_code">
                                    </td>
                                    <td>
                                        <select  [(ngModel)]="item.route_id" class="form-control" name="route_id" *ngIf="item.type == 2">
                                            <option value="null" selected="true">Select Route</option>
                                            <option *ngFor="let item of routeList" value="{{item.id}}" >{{item.route_gatetime}}</option>
                                        </select>
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-default" (click)="removeAddress(i)" *ngIf="item.allow_remove">
                                            <i class="fa fa-times" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button type="button" class="btn btn-outline-dark" (click)="addNewAddress()">
                        <i class="fa fa-plus" aria-hidden="true"></i> Add new address</button>
                </div>
            </div>
        </div>


        <div class="row" style="margin-top:15px;" *ngIf="generalForm.value.is_parent == true && generalForm.value.buyer_type=='CP'" >
            <div class="col-sm-12">
                <div class="custom-header">
                    <h3 class="custom-header">SITES:
                        <strong class="text-danger">{{sites.length}}</strong>
                        <span *ngIf="sites.length > 1">Records</span>
                        <span *ngIf="sites.length <= 1">Record</span>
                    </h3>
                    <div class="wrap-keyboard right-toggle-button" (click)="flagSite = !flagSite">
                        <span class="fa" [ngClass]="{'fa-minus': flagSite,'fa-plus': !flagSite}"></span>
                    </div>
                </div>
                <div *ngIf="flagSite">
                    <div class="customer-content-toggle">
                        <table class="table table-striped table-vcenter table-hover custom-table">
                            <thead>
                                <tr>
                                    <th> No </th>
                                    <th> Site Code </th>
                                    <th> Site Name </th>
                                    <th> Country </th>
                                    <th> Address 1 </th>
                                    <th> Address 2 </th>
                                    <th> City </th>
                                    <th> State </th>
                                    <th> Zip Code </th>
                                    <th> Action </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of sites; let i = index">
                                    <td>{{i+1}}</td>
                                    <td>
                                        {{item.code}}
                                    </td>
                                    <td>
                                        {{item.full_name}}
                                    </td>
                                    <td>
                                        {{item.country}}
                                    </td>
                                    <td>
                                        {{item.address_line}}
                                    </td>
                                    <td>
                                        {{item.address_line2}}
                                    </td>
                                    <td>
                                        {{item.city_name}}
                                    </td>
                                    <td>
                                        {{item.state}}
                                    </td>
                                    <td>
                                        {{item.zip_code}}
                                    </td>
                                    <td>
                                        <button [disabled]="item.id != null" type="button" class="btn btn-default" (click)="removeSite(i)">
                                            <i class="fa fa-times" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button type="button" class="btn btn-outline-dark" (click)="addNewSite()">
                        <i class="fa fa-plus" aria-hidden="true"></i> Add new site</button>
                </div>
            </div>
        </div>



        <div class="row" style="margin-top:15px;">
            <div class="col-sm-12">
                <div class="custom-header">
                    <h3 class="custom-header">BANK ACCOUNTS:
                        <strong class="text-danger">{{bank_accounts.length}}</strong>
                        <span *ngIf="bank_accounts.length > 1">Records</span>
                        <span *ngIf="bank_accounts.length <= 1">Record</span>
                    </h3>
                    <div class="wrap-keyboard right-toggle-button" (click)="flagAccount = !flagAccount">
                        <span class="fa" [ngClass]="{'fa-minus': flagAccount,'fa-plus': !flagAccount}"></span>
                    </div>
                </div>
                <div *ngIf="flagAccount">
                    <div class="customer-content-toggle">
                        <table class="table table-striped table-vcenter table-hover custom-table">
                            <thead>
                                <tr>
                                    <th> No </th>
                                    <th> Bank Name </th>
                                    <th> SWIFT </th>
                                    <th> Branch </th>
                                    <th> Address </th>
                                    <th> Account Name </th>
                                    <th> Account No </th>
                                    <th> IBAN </th>
                                    <th> Action </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of bank_accounts; let i = index" [ngClass]="{'hidden':item.is_deleted}">
                                    <td>{{i+1}}</td>
                                    <td>
                                        <select class="form-control" name="bank_id" [(ngModel)]="item.bank_id" (change)="changeBank(item)">
                                            <option value="null" selected="true">--Select--</option>
                                            <option *ngFor="let i of item.listBank" [ngValue]="i.id">{{i.name}}</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="text" readonly class="form-control-plaintext" name="bank_swift" [(ngModel)]="item.bank_swift">
                                    </td>
                                    <td>
                                        <select class="form-control" name="branch_id" [(ngModel)]="item.branch_id" (change)="changeBranch(item)">
                                            <option value="null" selected="true">--Select--</option>
                                            <option *ngFor="let i of item.listBranch" [ngValue]="i.id">{{i.branch_name}}</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="text" readonly class="form-control-plaintext" name="full_address" [(ngModel)]="item.full_address">
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" name="account_name" [(ngModel)]="item.account_name">
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" name="account_no" [(ngModel)]="item.account_no">
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" name="iban" [(ngModel)]="item.iban">
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-default" (click)="removeBankAccount(i)">
                                            <i class="fa fa-times" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button type="button" class="btn btn-outline-dark" (click)="addNewBankAccount()">
                        <i class="fa fa-plus" aria-hidden="true"></i> Add new account</button>
                </div>
            </div>
        </div>




        <!-- <div class="row" style="margin-top:15px;" *ngIf="false">
            <div class="col-sm-12">
                <div class="custom-header">
                    <h3 class="custom-header">BANK CARDS:
                        <strong class="text-danger">{{bank_card.length}}</strong>
                        <span *ngIf="bank_card.length > 1">Records</span>
                        <span *ngIf="bank_card.length <= 1">Record</span>
                    </h3>
                    <div class="wrap-keyboard right-toggle-button" (click)="flagCard = !flagCard">
                        <span class="fa" [ngClass]="{'fa-minus': flagCard,'fa-plus': !flagCard}"></span>
                    </div>
                </div>
                <div *ngIf="flagCard">
                    <div class="customer-content-toggle">
                        <table class="table table-striped table-vcenter table-hover custom-table">
                            <thead>
                                <tr>
                                    <th> No </th>
                                    <th> Card Type </th>
                                    <th> Card No </th>
                                    <th> Holder Name </th>
                                    <th> Expiry Date </th>
                                    <th> Action </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of bank_card; let i = index" [ngClass]="{'hidden':item.is_deleted}">
                                    <td>{{i+1}}</td>
                                    <td>
                                        <select class="form-control" name="card_type" [(ngModel)]="item.card_type">
                                            <option value="null" selected="true">--Select--</option>
                                            <option *ngFor="let i of item.listCardType" [ngValue]="i.id">{{i.name}}</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" name="card_no" [(ngModel)]="item.card_no">
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" name="holder" [(ngModel)]="item.holder">
                                    </td>
                                    <td>
                                        <div class="input-group">
                                            <input class="form-control" placeholder="yyyy-mm-dd" name="expiry_dt" [(ngModel)]="item.expiry_dt" ngbDatepicker #d="ngbDatepicker">
                                            <div class="input-group-append">
                                                <button class="btn btn-outline-secondary" (click)="d.toggle()" type="button">
                                                    <i class="fa fa-calendar" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                            <button type="button" class="btn btn-default" (click)="removeBankCard(i)">
                                                <i class="fa fa-times" aria-hidden="true"></i>
                                            </button>
                                            <button type="button" class="btn btn-default" (click)="removeBankCard(i)">
                                                <i class="fa fa-times" aria-hidden="true"></i>
                                            </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button type="button" class="btn btn-outline-dark" (click)="addNewBankCard()">
                        <i class="fa fa-plus" aria-hidden="true"></i> Add new bank card</button>
                </div>
            </div>
        </div> -->



        <div class="row" style="margin-top:15px;" *ngIf="generalForm.value.buyer_type == 'CP'">
            <div class="col-sm-12">
                <div class="custom-header">
                    <h3 class="custom-header">CONTACTS:
                        <strong class="text-danger">{{contacts.length}}</strong>
                        <span *ngIf="contacts.length > 1">Records</span>
                        <span *ngIf="contacts.length <= 1">Record</span>
                    </h3>
                    <div class="wrap-keyboard right-toggle-button" (click)="flagContact = !flagContact">
                        <span class="fa" [ngClass]="{'fa-minus': flagContact,'fa-plus': !flagContact}"></span>
                    </div>
                </div>
                <div *ngIf="flagContact">
                    <div class="customer-content-toggle">
                        <table class="table table-striped table-vcenter table-hover custom-table">
                            <thead>
                                <tr>
                                    <th> No </th>
                                    <th> Name </th>
                                    <th> Title </th>
                                    <th> Phone </th>
                                    <th> Fax </th>
                                    <th> Email </th>
                                    <th> Username </th>
                                    <th> Password </th>
                                    <th> Action </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of contacts; let i = index">
                                    <td>{{i+1}}</td>
                                    <td>
                                        <input type="text" class="form-control" name="full_name" [(ngModel)]="item.full_name">
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" name="title" [(ngModel)]="item.title">
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" name="phone" [(ngModel)]="item.phone">
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" name="fax" [(ngModel)]="item.fax">
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" name="email" [(ngModel)]="item.email">
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" name="username" [(ngModel)]="item.username">
                                    </td>
                                    <td>
                                        <input type="password" class="form-control" name="pwd" [(ngModel)]="item.pwd">
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-default" (click)="removeContact(i)">
                                            <i class="fa fa-times" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button type="button" class="btn btn-outline-dark" (click)="addNewContact()">
                        <i class="fa fa-plus" aria-hidden="true"></i> Add new contact</button>
                </div>
            </div>
        </div>

        <div class="block-content block-content-full text-right" style="margin-top:15px;">
            <button type="button" class="btn btn-default" [routerLink]="['/customer']">Cancel</button>
            <button type="button" [disabled]="generalForm.invalid" class="btn btn-outline-primary" (click)="updateCustomer()">Save</button>
        </div>
    </section>
</div>